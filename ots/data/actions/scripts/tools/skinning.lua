local config = {
	[5908] = {
		-- Minotaurs
		[2830] = {value = 25000, newItem = 5878},
		[2871] = {value = 25000, newItem = 5878},
		[2866] = {value = 25000, newItem = 5878},
		[2876] = {value = 25000, newItem = 5878},
		[3090] = {value = 25000, newItem = 5878},
		[5969] = {value = 25000, newItem = 5878, after = 3091},
		[5981] = {value = 25000, newItem = 5878, after = 2867},
		[5982] = {value = 25000, newItem = 5878, after = 2872},
		[5983] = {value = 25000, newItem = 5878, after = 2877},
		[23367] = {value = 25000, newItem = 5878, after = 23369},
		[23368] = {value = 25000, newItem = 5878},
		[23371] = {value = 25000, newItem = 5878, after = 23373},
		[23372] = {value = 25000, newItem = 5878},
		[23375] = {value = 25000, newItem = 5878, after = 23377},
		[23376] = {value = 25000, newItem = 5878},
		[23462] = {value = 25000, newItem = 5878, after = 23464},
		[23463] = {value = 25000, newItem = 5878},
		[23467] = {value = 25000, newItem = 5878},
		[23466] = {value = 25000, newItem = 5878, after = 23468},
		[23470] = {value = 25000, newItem = 5878, after = 23472},
		[23471] = {value = 25000, newItem = 5878},
		[23472] = {value = 25000, newItem = 5878},

		-- Low Class Lizards
		[4256] = {value = 25000, newItem = 5876},
		[4259] = {value = 25000, newItem = 5876},
		[4262] = {value = 25000, newItem = 5876},
		[4251] = {value = 25000, newItem = 5876, after = 4257},
		[6040] = {value = 25000, newItem = 5876, after = 4260},
		[6041] = {value = 25000, newItem = 5876, after = 4263},

		-- High Class Lizards
		[11285] = {value = 25000, newItem = 5876},
		[11285] = {value = 25000, newItem = 5876},	
		[11288] = {value = 25000, newItem = 5876, after = 11286},
		[11277] = {value = 25000, newItem = 5876},
		[11276] = {value = 25000, newItem = 5876, after = 11273},
		[11280] = {value = 25000, newItem = 5876, after = 11278},
		[11269] = {value = 25000, newItem = 5876},
		[11272] = {value = 25000, newItem = 5876, after = 11270},
		[11281] = {value = 25000, newItem = 5876},
		[11284] = {value = 25000, newItem = 5876, after = 11282},

		-- Dragons
		[3104] = {value = 25000, newItem = 5877},
		[2844] = {value = 25000, newItem = 5877},
		[5973] = {value = 25000, newItem = 5877, after = 3105},
		[7621] = {value = 25000, newItem = 5877, after = 7626},
		[7623] = {value = 25000, newItem = 5877, after = 7626},

		-- Dragon Lords
		[2881] = {value = 25000, newItem = 5948},
		[5984] = {value = 25000, newItem = 5948, after = 2882},
		[7624] = {value = 25000, newItem = 5948},
		[7622] = {value = 25000, newItem = 5948, after = 7625},

		-- Behemoths
		[2931] = {value = 35000, newItem = 5893},
		[5999] = {value = 25000, newItem = 5893, after = 2932},

		-- Bone Beasts
		[3031] = {value = 25000, newItem = 5925},
		[6030] = {value = 25000, newItem = 5925, after = 3032},

		-- Wolf
		[2826] = {value = 25000, newItem = 5897},
		[5968] = {value = 25000, newItem = 5897, after = 2827},

		-- Bear
		[2849] = {value = 15000, newItem = 5896},
		[5975] = {value = 15000, newItem = 5896, after = 2850},

		-- Deer
		[2835] = {value = 15000, newItem = 11214},
		[5970] = {value = 15000, newItem = 11214, after = 2836},

		-- Bat
		[4298] = {value = 30000, newItem = 5894},
		[6053] = {value = 30000, newItem = 5894, after = 4299},

		-- Elephant
		[4295] = {value = 25000, newItem = 3956},
		[6052] = {value = 25000, newItem = 3956, after = 4296},

		-- wyrm
		[8942] = {value = 20000, newItem = 10582},
		[8941] = {value = 20000, newItem = 10582, after = 8943},

		-- elder wyrm
		[21284] = {value = 25000, newItem = 10582},
		[21283] = {value = 25000, newItem = 10582, after = 21285},

		-- jung sea serpent
		[9880] = {value = 15000, newItem = 10583},
		[9879] = {value = 15000, newItem = 10583, after = 9881},

		-- sea serpent
		[8308] = {value = 20000, newItem = 10583, after = 8311},
		[8307] = {value = 20000, newItem = 10583, after = 8311},

		-- hydra
		[4283] = {value = 15000, newItem = 11199},
		[6048] = {value = 15000, newItem = 11199, after = 4284},

		-- Sheep
		[2905] = {value = 15000, newItem = 11236},
		[5991] = {value = 15000, newItem = 11236, after = 2906},

		-- chicken
		[4265] = {value = 25000, newItem = 5890},
		[6042] = {value = 25000, newItem = 5890, after = 4266},

		-- hellspawn
		[9924] = {value = 20000, newItem = 11221},
		[9923] = {value = 20000, newItem = 11221, after = 9925},

		-- frost dragon
		[7092] = {value = 20000, newItem = 10578},
		[7091] = {value = 20000, newItem = 10578, after = 7093},

		-- frost dragon hatch
		[7970] = {value = 10000, newItem = 10578},
		[7969] = {value = 10000, newItem = 10578, after = 7971},

		-- The Mutated Pumpkin
		[8961] = { { value = 5000, newItem = 7487 }, { value = 10000, newItem = 7737 }, { value = 20000, 6492 }, { value = 30000, newItem = 8860 }, { value = 45000, newItem = 2683 }, { value = 60000, newItem = 2096 }, { value = 90000, newItem = 9005, amount = 50 } },
		[8962] = { { value = 5000, newItem = 7487 }, { value = 10000, newItem = 7737 }, { value = 20000, 6492 }, { value = 30000, newItem = 8860 }, { value = 45000, newItem = 2683 }, { value = 60000, newItem = 2096 }, { value = 90000, newItem = 9005, amount = 50 } },
		[8963] = { { value = 5000, newItem = 7487 }, { value = 10000, newItem = 7737 }, { value = 20000, 6492 }, { value = 30000, newItem = 8860 }, { value = 45000, newItem = 2683 }, { value = 60000, newItem = 2096 }, { value = 90000, newItem = 9005, amount = 50 } },
		-- Q3 ZMIANY
		-- Humans
		[3058] = { {value = 5000, newItem = 5909 , after = 3059}, 
				   {value = 10000, newItem = 5910 , after = 3059}, 
				   {value = 15000, newItem = 5911 , after = 3059},
				   {value = 20000, newItem = 5912 , after = 3059},
				   {value = 25000, newItem = 5913 , after = 3059},
				   {value = 30000, newItem = 5914 , after = 3059},
				   {value = 35000, newItem = 2230 , after = 3059},
				},
		[3065] = { {value = 5000, newItem = 5909 , after = 3066}, 
				   {value = 10000, newItem = 5910 , after = 3066}, 
				   {value = 15000, newItem = 5911 , after = 3066},
				   {value = 20000, newItem = 5912 , after = 3066},
				   {value = 25000, newItem = 5913 , after = 3066},
				   {value = 30000, newItem = 5914 , after = 3066},
				   {value = 35000, newItem = 2230 , after = 3066},
				},
		-- Q3 ZMIANY
	},
	[5942] = {	
		-- Demon
        [2916] = {value = 6000, newItem = 5906},
        [5995] = {value = 6000, newItem = 5906, after = 2917},
		
		-- Vampires
		[2956] = {value = 6000, newItem = 5905},
		[6006] = {value = 6000, newItem = 5905, after = 2957},
		[8938] = {value = 6000, newItem = 5905},
		[9654] = {value = 6000, newItem = 5905, after = 9658},
		[21275] = {value = 6000, newItem= 5905},
		[21278] = {value = 6000, newItem = 5905, after = 21276}
	}
}

function onUse(player, item, fromPosition, target, toPosition, isHotkey)
	-- Q3
	if (target.itemid == 3058 or target.itemid == 3065) and player:getStorageValue(11066) < 2 then
		return true
	end
	-- Q3
	-- Q4
	if (target.itemid == 3058 or target.itemid == 3065) and player:getStorageValue(11067) == 1 then
		local radn = math.random()
		if radn >= 0.9 then
			player:setStorageValue(11075,player:getStorageValue(11075) + 1) -- dodaje 1 watrobke
			doCreatureSay(toPosition,'Udalo Ci sie wyciac watrobe',TALKTYPE_ORANGE_1)
		elseif radn <= 0.05 then
			player:setStorageValue(11074,player:getStorageValue(11074) + 1) -- dodaje 1 serce
			doCreatureSay(toPosition,'Udalo Ci sie wyciac serce',TALKTYPE_ORANGE_1)
		end
	end
	-- Q4
    local skin = config[item.itemid][target.itemid]
    if item.itemid == 5908 and target.itemid == 13633 and target.uid == 11018 then
		if player:getStorageValue(11017) == 1 then
			doSendMagicEffect(toPosition, 49)
			doCreatureSay(toPosition,'Wuf wuf',TALKTYPE_ORANGE_1)
			player:setStorageValue(11017,2)
		end
		return true
	end
	if target.itemid == 11343 then -- marble sclupting
        local rand = math.random(6000)
        target:getPosition():sendMagicEffect(tonumber(10))
        if rand <= 3757 then
            if rand <= 830 then
                target:transform(11344)
                target:setDescription("Ta mizerna praca zostala wykonana przez ".. player:getName() ..".")
				player:say('Slabo...', TALKTYPE_MONSTER_SAY)
            elseif rand > 900 and rand <= 4900 then
                target:transform(11345)
                target:setDescription("Ta mala statuetka zostala wykonana przez ".. player:getName() .."... i wymaga poprawek.")
				player:say('Blisko perfekcji...', TALKTYPE_MONSTER_SAY)
            else
                target:transform(11346)
                target:setDescription("Ta statuetka Tibiasuli zostala mistrzowsko wyrzezbiona przez ".. player:getName() ..".")
				player:say('Brawo! Udalo sie, bedzie do CV.', TALKTYPE_MONSTER_SAY)
            end
        else
            player:say('Proba zakonczyla sie fiaskiem.', TALKTYPE_MONSTER_SAY)
            target:remove()
        end
		return true
    end

    if isInArray({7441, 7442, 7444, 7445}, target.itemid) then -- ice cube
        local rand = math.random(50000)
        target:getPosition():sendMagicEffect(tonumber(10))   
        if target.itemid == 7445 and rand <= 7000 then
            target:transform(7446)
        elseif target.itemid == 7444 and rand <= 10000 then
            target:transform(7445)
        elseif target.itemid == 7442 and rand <= 20000 then
            target:transform(7444)
        elseif target.itemid == 7441 and rand <= 31000 then
            target:transform(7442)
        else
            target:remove()
            player:say('Proba rzezbienia zakonczyla sie porazka.', TALKTYPE_MONSTER_SAY)
        end
		return true
    end
	--overlord


	if target.itemid == 9009 or target.itemid == 9010 then
		if player:getStorageValue(Storage.ElementalSphere.LordSkin) >= os.time() then
			return player:say('Nic tu nie ma..', TALKTYPE_MONSTER_SAY)
		end
			player:setStorageValue(Storage.ElementalSphere.LordSkin, os.time() + 3 * 60)
			player:addItem(8310, 1)
			player:say('Pozyskales Neutralna Materie.', TALKTYPE_MONSTER_SAY)
		return true
	end	

    if not skin then
        player:sendCancelMessage(RETURNVALUE_NOTPOSSIBLE)
        return true
    end
	
	local random, effect, transform = math.random(1, 150000), CONST_ME_MAGIC_GREEN, true
    if type(skin[1]) == 'table' then
        local added = false
        for _, _skin in ipairs(skin) do
            if random <= _skin.value then
                player:addItem(_skin.newItem, _skin.amount or 1)
                added = true
            break
            end
        end

        if not added and target.itemid == 8961 then
            effect = CONST_ME_POFF
            transform = false
        end
    elseif random <= skin.value then
        player:addItem(skin.newItem, skin.amount or 1)
    else
        effect = CONST_ME_POFF
    end

    toPosition:sendMagicEffect(effect)
    if transform and target.itemid ~= 8961 and target.itemid ~= 8962 and target.itemid ~= 8963 then
        target:transform(skin.after or target.itemid + 1)
    end

    return true
end